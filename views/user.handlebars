{{> navbar user}}

<h2>THIS IS THE FUTURE USER PAGE!!!!!!</h2>
<h3>We want this to show information about the user, the name, the gender, the age, contact information such as ph num and current activity(or most recent activity)</h3>
<h4>and maybe a user image</h4>
<div class="container">
    <div class="row">
        <div class="col-md">
            <div class="jumbotron">
                <h4 class="display-6">Hello, {{user.email}}!</h4>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md">
            <legend>Fun things to do</legend>
            <div id="activities">
                {{#each activities}}
                <div class="activity-post-card card text-white bg-primary mb-3">
                    <div class="card-header">
                        <h4 class="text-white">{{name}}</h4>
                    </div>
                    <div class="card-body">
                        <p class="card-text">{{description}}</p>
                        by {{'User.email'}}
                        @ {{createdAt}}
                    </div>
                    
                    

                    <div class="form-group">
                        <!-- Zip Code-->
                        <label for="zip_id" class="control-label">Zip Code</label>
                        <input type="text" class="form-control" id="zip_id" name="zip" placeholder="#####">
                    </div>

                </div>
                {{/each}}
            </div>
        </div>


    </div>

    <div class="row">
        <div class="col-md">
            <form class="activities">
                <fieldset>
                    <legend>Create Your Own Activity</legend>
                    <p>
                        Type in your Activity name, description and url reference to the activity below, and click
                        submit to send it to our database. We will
                        register it with your email address, and display it above with everyone else's activities!</p>
                    </p>
                    <div class="form-group">
                        <label for="title-input">Name</label>
                        <input type="text" class="form-control" id="title-input" aria-describedby="postHelp"
                            placeholder="Enter your activity name">
                        <small id="postHelp" class="form-text text-muted">This'l be shared!</small>
                    </div>
                    <div class="form-group">
                        <label for="body-input">Description</label>
                        <textarea class="form-control" id="body-input" name="body"
                            placeholder="Enter your post body"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="url-input">URL</label>
                        <input type="text" id="url-input" aria-describedby="postHelp" placeholder="Enter Activity URL">
                    </div>
                    <button type="submit" class="btn btn-primary">Post!</button>
                </fieldset>
            </form>
            <br />
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        // Getting references to our form and inputs
        const postForm = $("form.activities");
        const titleInput = $("input#title-input");
        const bodyInput = $("textarea#body-input");
        const urlInput = $("input#url-input")

        // When the form is submitted, we validate there's a title and body entered
        postForm.on("submit", function (event) {
            event.preventDefault();
            console.log(bodyInput.val(), titleInput.val())
            var postData = {
                name: titleInput.val().trim(),
                description: bodyInput.val().trim(),
                url: urlInput.val().trim()
            };

            if (!postData.name || !postData.description || !postData.url) {
                return;
            }


            // If we have a title and password  we run the sendPost function and clear the form
            sendPost(postData.name, postData.description, postData.url);
            titleInput.val("");
            bodyInput.val("");
            urlInput.val("");
        });

        // sendPost does a post to our "api/posts" route and if successful, redirects us the the activity page
        function sendPost(name, description, url) {
            $.post("/api/activities", {
                name: name,
                description: description,
                url: url
            })
                .then(function () {
                    window.location.replace("/activity");
                    // If there's an error, log the error
                })
                .catch(function (err) {
                    console.log(err);
                });

        }
    })
</script>